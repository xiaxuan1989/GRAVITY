\chapter{范畴论}\label{appx:cat}
首先，默认读者已熟悉主要的集合、映射与关系知识，包括差集、交并补运算律、卡氏积(Cartisian product)、指标集、可数性、等价类、划分、幂集、陪域、逆像、双射等概念。若对这些概念有所遗忘，可查阅任意分析学、代数学教材以复习。

请读者大致回顾至今学习的\textit{所有知识}。我们遇到过各种各样的事物，它们之间又存在着各种联系：从整数之间的大小比较，到集合之间的映射，再到线性空间之间的同构。1940 年代，MacLane 为研究代数拓扑、线性代数中自然同构的问题，试图抽象这一思想，将各个东西及其间的联系，放到一个整体的学说中研究。这些“东西”称为\textbf{对象}(object)，它们之间的关系用箭头(arrow)表示，称为\textbf{态射}(morphism)。
指定一组对象构成的集合及其间所有态射之集，就给出了一个\textbf{范畴}(category)。
范畴论将我们熟知的知识进行进一步的抽象封装。
我们不关心一个集合里具体有什么，而是把每个集合看作一个对象；不关心究竟把某个元素映射至何处，而是把映射单纯地看成箭头，研究集合上任意映射之集。
如此，全体集合构成\textbf{集合范畴} $\cate{Set}$。
我们有了一种更为普适、简洁的视角去看待很多理论。

不仅如此，由于这些理论中的态射都具有相似性质（比如复合函数的结合性），这意味着这些理论实质上有非常紧密的联系待发掘。利用范畴论，就很容易找到不同理论之间的对应，比如欧氏几何和用代数表达图形的解析方法。甚至，可将某个理论的概念套进范畴的模版里，进一步发展原有的理论。
在范畴论里，\textit{关系就是一切}。许多情况下，一个数学对象完全由它与所有其他对象的关系决定。换言之，当且仅当两个对象以同样方式与范畴中的每个对象相关时，两个对象本质上是不可区分的。这是著名的\textbf{米田引理}(Yoneda lemma)的一个推论。这同我们的日常经验相符，你大可通过观察一个人的社交关系来确定其性格；若你发现两个社交媒体账号，其关注和动态高度一致，则有理由推断此二账号同属一人。于是，范畴论可以成为构建一个数学理论的蓝图，被称为\textit{数学的数学}。

剩下的关键在于对态射需设置何种要求。一般希望态射的复合具有结合性，且存在到自身的态射。为保证足够的抽象和普适性，这可以是全部的要求了：
\begin{definition}
    设两集合 $\mathrm{Ob},\mathrm{Mor}$，它们之间配上一对映射
     $\begin{tikzcd} \mathrm{Mor} \arrow[yshift=-0.5ex, r, "t"'] \arrow[yshift=0.5ex, r, "s"] & \mathrm{Ob} \end{tikzcd}$。
    将 $\mathrm{Ob}$ 的元素称作\textbf{对象}，$\mathrm{Mor}$ 的元素称为\textbf{态射}。对某个态射 $f\in\mathrm{Mor}$，映射 $s,t$ 的像分别指明其\textbf{来源}(source)和\textbf{目标}(target)，也即域和陪域。
    对 $X, Y \in \mathrm{Ob}$，记 $\hom(X, Y) := s^{-1}\{X\} \cap t^{-1}\{Y\}\subset\mathrm{Mor}$，称为 $\hom$-集，其元素称为从 $X$ 到 $Y$ 的态射。
    
    态射还满足如下要求。对任意对象 $X$ 都存在 $\mathrm{id}_X \in \hom(X, X)$，称为 $X$ 到自身的\textbf{恒等}(identity)\textbf{态射}。可证同个对象的任意两个恒等态射是相等的，故其实恒等态射是存在且唯一的。对任意 $X, Y, Z \in \mathrm{Ob}$，给定态射间的\textbf{复合}(composition)
        \begin{align*}
            \circ : \hom(Y, Z) \times \hom(X, Y) & \longrightarrow \hom(X, Z), \\
            (f, g) & \longmapsto f \circ g,
        \end{align*}
        不致混淆时常将 $f \circ g$ 简记为 $fg$，满足
        \begin{itemize}
            \item 结合律(associativity)，即对任意 $h, g, f \in \mathrm{Mor}$，若复合 $f(gh)$ 和 $(fg)h$ 都有定义，则 $f (g h) = (f g) h$。
            故两边可以同写为 $f \circ g \circ h$ 或 $fgh$；
            \item 对任意 $f \in \hom(X,Y)$，有 $f \circ \mathrm{id}_X = f = \mathrm{id}_Y \circ f$。
        \end{itemize}
    $(\mathrm{Ob},\mathrm{Mor})$ 称为一个\textbf{范畴}。常记 $\mathcal C=(\mathrm{Ob}(\mathcal C),\mathrm{Mor}(\mathcal C))$。对象及其态射常记作 $X\xrightarrow{f} Y$ 的形式。
\end{definition}

著名的 \textbf{Russell 佯谬}考虑了所有集合构成的“集合” $\textbf{V}$，利用\textbf{自我指涉}的思想，构造其子“集合” $\{x \in \textbf{V} : x \notin x\}$ 可导出矛盾。现代集合论处理此问题的主流方法是限制概括原理
\[\left\{x : x \text{ 满足性质 } P\right\}\]
的应用范围，并在一阶逻辑与合适的公理系统下进行演绎。以上提到的“集合” $\textbf{V}$ 实非集合，而称作\textbf{类}(class)。凡集合都是类，但还存在非集合的类，称作\textbf{真类}。通过使用元语言并避开额外逻辑可以承认类的存在性，因为用 Russell 佯谬推出矛盾需要额外的逻辑。故原则上Ob, Mor可以是一般的类，比如 Ob$(\cate{Set})$ 是真类。

图表加箭头是讨论范畴的方便语言。用箭头表达态射，用箭头的头尾衔接表示复合映射。最常用的是\textbf{交换图}(commutative diagram)，“交换”意指箭头的复合殊途同归，例如
    \[ \begin{tikzcd}
        X \arrow[rr, "f"] \arrow[rd, "h"'] & & Y \arrow[ld, "g"] \\
        & Z &
    \end{tikzcd} \qquad \begin{tikzcd}
        A \arrow[r, "u"] \arrow[d, "x"'] & B \arrow[d, "v"] \\
        C \arrow[r, "y"'] & D
    \end{tikzcd} \]
的交换性分别等价于 $g f = h$ 和 $v u = y x$。态射的名称若自明或不重要，则常从图中略去。

\begin{definition}
    对于态射 $X \xrightarrow{f} Y$，若存在 $Y \xrightarrow{g} X$ 使得 $f g = \mathrm{id}_Y,g f = \mathrm{id}_X$，则称 $f$ 是（对象）\textbf{同构}(isomorphism)，而 $g$ 称为 $f$ 的\textbf{逆}，从恒等态射的性质易见逆若存在则唯一。从 $X$ 到 $Y$ 的同构集记作 $\mathrm{Isom}(X, Y)$。

    记 $\operatorname{End} X := \hom(X, X),\operatorname{Aut} X := \mathrm{Isom}(X, X)$，分别称作 $X$ 的\textbf{自同态集}和\textbf{自同构集}。这些集合在二元运算 $\circ$ 下封闭，或用代数的语言来说：$\operatorname{Aut} X$ 是群，
    $\operatorname{End} X$ 是幺半群。若忘记其定义可见下节。
\end{definition}

一个范畴往往代表一套理论。研究范畴间的关系可进一步抽象出如下概念：
\begin{definition}
    设 $\mathcal{C}', \mathcal{C}$ 为范畴。映射 $F: \mathcal{C}' \to \mathcal{C}$ 称为\textbf{函子}(functor)，包括：
    \begin{enumerate}
        \item 对象间的映射 $F: \mathrm{Ob}(\mathcal C')\to\mathrm{Ob}(\mathcal C)$.
        \item 态射间的映射 $F: \mathrm{Mor}(\mathcal C')\to \mathrm{Mor}(\mathcal C)$, 使得
            \begin{itemize}
                \item $F$ 与来源和目标映射相交换 （即 $sF=Fs$, $tF=Ft$），或等价地，对每个 $X, Y \in \mathrm{Ob}(\mathcal{C}')$ 皆有映射 $F: \hom_{\mathcal{C}'}(X, Y) \to \hom_{\mathcal{C}}(F(X), F(Y))$。换言之，$f\in \hom_{\mathcal{C}'}(X, Y)\Rightarrow F(f)\in \hom_{\mathcal{C}}(F(X), F(Y))$；
                \item $F(g\circ^{\prime} f) = F(g) \circ F(f)$，$F(\mathrm{id}_X) = \mathrm{id}_{F(X)}$。
            \end{itemize}
    \end{enumerate}
    对于 $F: \mathcal{C}_1 \to \mathcal{C}_2,G: \mathcal{C}_2 \to \mathcal{C}_3$，\textbf{复合函子} $G \circ F: \mathcal{C}_1 \to \mathcal{C}_3$ 的定义显然是取相应复合映射：$\mathrm{Ob}(\mathcal{C}_1) \xrightarrow{F} \mathrm{Ob}(\mathcal{C}_2) \xrightarrow{G} \mathrm{Ob}(\mathcal{C}_3)$ 和 $\mathrm{Mor}(\mathcal{C}_1) \xrightarrow{F} \mathrm{Mor}(\mathcal{C}_2) \xrightarrow{G} \mathrm{Mor}(\mathcal{C}_3)$。
\end{definition}

上述函子又称为\textbf{协变函子}。交换图表述为
\[\begin{tikzcd}
    X \arrow[r, "f"] \arrow[d, "F"'] & Y \arrow[r, "g"] \arrow[d, "F"'] & Z \arrow[d, "F"]\\
    F(X) \arrow[r, "F(f)"] & F(Y) \arrow[r, "F(g)"] & F(Z).
\end{tikzcd}\]
相应地，\textbf{逆变函子}就是将关于复合映射的性质改为 $F(f):F(Y)\to F(X),F(gf) = F(f) \circ F(g)$，故交换图为
\[\begin{tikzcd}
    X \arrow[r, "f"] \arrow[d, "F"'] & Y \arrow[r, "g"] \arrow[d, "F"'] & Z \arrow[d, "F"]\\
    F(X) & \arrow[l, "F(f)"'] F(Y) & \arrow[l, "F(g)"'] F(Z).
\end{tikzcd}\]

可以考虑反转某个范畴的所有箭头，而反转后范畴论的公理依然成立，范畴论中的这种对称性也称作对偶原理：
\begin{definition}
    范畴 $\mathcal{C}$ 的\textbf{反范畴}(opposite category)或\textbf{对偶范畴} $\mathcal{C}^\mathrm{op}$ 定义如下：
    \begin{itemize}
        \item $\mathrm{Ob}(\mathcal{C}^{\mathrm{op}}) = \mathrm{Ob}(\mathcal{C})$；
        \item 对任意对象 $X, Y$，$\hom_{\mathcal{C}^{\mathrm{op}}}(X, Y) := \hom_{\mathcal{C}}(Y, X)$；
        \item 态射 $f \in \hom_{\mathcal{C}^{\mathrm{op}}}(Y, Z), g \in \hom_{\mathcal{C}^{\mathrm{op}}}(X, Y)$ 在 $\mathcal{C}^{\mathrm{op}}$ 中的复合 $f \circ^\mathrm{op} g$ 定义为 $\mathcal{C}$ 中的反向复合 $g \circ f$；
        \item 恒等态射定义同 $\mathcal{C}$.
    \end{itemize}
\end{definition}
容易验证 $\mathcal{C}^\text{op}$ 满足范畴定义，且 $(\mathcal{C}^\text{op})^{\text{op}} = \mathcal{C}$。在处理许多范畴论性质时，善用对偶原理能省事不少。比如，逆变函子其实即形如 $F: (\mathcal{C}')^\text{op} \to \mathcal{C}$ 的（协变）函子。

研究函子间的态射可进一步抽象：
\begin{definition}
    函子 $F, G: \mathcal{C}' \to \mathcal{C}$ 之间的\textbf{自然变换}(natural transformation) $\theta$ 是一族态射 $\{\theta_X\}$，其中 $\theta_X \in \hom_{\mathcal{C}}(F(X), G(X))$ 且 $X \in \mathrm{Ob}(\mathcal{C}')$，使得下图对所有 $\mathcal{C}'$ 中的态射 $f: X \to Y$ 交换：
    \begin{equation}\begin{tikzcd}
        F(X) \arrow[r, "\theta_X"] \ar[d, "F(f)"'] & G(X) \arrow[d, "G(f)"] \\
        F(Y) \arrow[r, "\theta_Y"] & G(Y) .
    \end{tikzcd}\end{equation}
    上述自然变换写作 $\theta: F \Rightarrow G$，或图解为
    \[ \begin{tikzcd}
        \mathcal{C}' \arrow[bend left=50, r, "F", ""' name=U] \arrow[bend right=50, r, "G"', "" name=D] & \arrow[Rightarrow, to path=(U) -- (D) \tikztonodes, "\theta"] \mathcal{C}.
    \end{tikzcd} \]
    上述带有双箭头的图表有时也被称为 \textbf{2-胞腔}(2-cell)。
\end{definition}

实用中经常会省略严格的范畴论框架，只说态射 $\theta_X: F(X) \to G(X)$ 对于变元 $X$ 是\textbf{自然的}或\textbf{典范的}(canonical)，或称满足\textbf{函子性}。

任意函子 $F$ 到自身有恒等的 $\mathrm{id}_F : F \Rightarrow F$。对于 $\theta: F_1 \Rightarrow F_2$，若 $\psi: F_2 \Rightarrow F_1$ 满足 $\psi \circ \theta = \mathrm{id}_{F_1}$，$\theta \circ \psi = \mathrm{id}_{F_2}$，则称 $\psi$ 是 $\theta$ 的逆。可逆的自然变换称为\textbf{函子同构}。由定义直接看出 $\theta$ 的逆若存在则是唯一的，记作 $\theta^{-1}$，它无非是在范畴中\textit{逐点}取逆：$(\theta^{-1})_X := (\theta_X)^{-1}: F_2 X \to F_1 X$。同理可见 $\theta$ 可逆当且仅当任意 $\theta_X$ 可逆（同构）。函子同构 $\theta: F_1 \Rightarrow F_2$ 的等价说法是称 $\theta_X: F_1 X \to F_2 X$ 对变元 $X$ 是\textbf{自然同构}或\textbf{典范同构}。更抽象的概念纳入到了\textbf{高维范畴论}的领域。
